<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IndianOil Receipt 58mm</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        background: #e6e6e6;
        font-family: "Courier New", monospace;
    }

    .container {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* ---------- INPUT FORM ---------- */
    .form-box {
        background: #fff;
        padding: 12px;
        width: 260px;
        font-size: 12px;
    }

    .form-box h3 {
        margin: 0 0 8px;
        text-align: center;
    }

    .form-box label {
        display: block;
        margin-top: 6px;
    }

    .form-box input {
        width: 100%;
        padding: 4px;
        font-family: inherit;
        font-size: 12px;
    }

    .form-box button {
        width: 100%;
        margin-top: 10px;
        padding: 6px;
        cursor: pointer;
    }

    /* ---------- RECEIPT ---------- */
    .station_name {
        padding-left: 15px ;
    }
    .receipt {
        width: 220px; /* ~58mm */
        padding: 50px 15px 50px;     /* top + bottom space */
        background: #f8f6f6;
        margin: 20px auto;
        color: #000;
        font-size: 12px;
        line-height: 1.15; /* tightened */
    }

    .center { text-align: center; }
    .bold { font-weight: bold; }
    .spacer { height: 4px; }
    .line { 
        white-space: pre;
        padding-left:15px;
    }

    .logo {
        width: 70px;
        margin: 0 auto 4px;
        display: block;
    }

    /* Logo */
    .iocl-logo {
        width: 70px;
        margin: 0 auto 8px;
    }

    .iocl-circle {
        width: 70px;
        height: 70px;
        border: 3px solid #000;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .iocl-bar {
        width: 100%;
        background: #000;
        color: #fff;
        font-size: 11px;
        padding: 3px 0;
        font-family: Arial, sans-serif;
    }

    .export-btn {
        display: block;
        margin: 15px auto;
        padding: 6px 12px;
        font-size: 12px;
        cursor: pointer;
    }

    @media print {
        .form-box, .export-btn {
            display: none;
        }
        body {
            background: none;
        }
        .receipt {
            width: 58mm;
        }
    }
</style>
</head>
<body>

<div class="container">

    <!-- INPUT FORM -->
    <div class="form-box">
        <h3>Receipt Input</h3>

        <label>Receipt No <input id="in_receiptNo" value="L6100"></label>
        <label>FCC ID <input id="in_fccId" value="302463058"></label>
        <label>FIP No <input id="in_fipNo" value="01"></label>
        <label>Nozzle No <input id="in_nozzleNo" value="03"></label>
        <label>Product <input id="in_product" value="Petrol"></label>

        <label>Preset Type <input id="in_presetType" value="Volume"></label>
        <label>Rate (Rs/L) <input id="in_rate" value="107.46" oninput="calculateAmount(); updateReceipt();"></label>
        <label>Volume (L) <input id="in_volume" value="31.19" oninput="calculateAmount(); updateReceipt();"></label>
        <label>Amount (Rs) <input id="in_amount" value="3351.88" readonly></label>

        <label>Atot <input id="in_atot" value="00106055516.87"></label>
        <label>Vtot <input id="in_vtot" value="0000984377.050"></label>

        <label>Vehicle No <input id="in_vehicleNo" value="Not Entered"></label>
        <label>Mobile No <input id="in_mobileNo" value="Not Entered"></label>

        <label>Date <input id="in_date" value="30/12/25"></label>
        <label>Time <input id="in_time" value="14:34"></label>

        <label>CST No <input id="in_cstNo"></label>
        <label>LST No <input id="in_lstNo"></label>
        <label>VAT No <input id="in_vatNo" value="36AAFAG452P1ZV"></label>

        <button onclick="updateReceipt()">Update Receipt</button>
    </div>

    <!-- RECEIPT PREVIEW -->
    <div>
        <div class="receipt" id="receipt">

            <div class="iocl-logo">
                <div class="iocl-circle">
                    <div class="iocl-bar">इंडियनऑयल</div>
                </div>
            </div>

            <div class="center bold">IndianOil</div>
            <div class="center">Welcomes You</div>

            <div class="spacer"></div>

            <div class="station_name" id="station_name">
                GANESH SERVICE STATION<br>
                NIZAMPAT X ROAD<br>
                KUKATPALLY 500085<br>
                Tel No : 9133333553
            </div>

            <div class="spacer"></div>

            <div class="line">Receipt No : <span id="receiptNo"></span></div>
            <div class="line">FCC ID : <span id="fccId"></span></div>
            <div class="line">FIP No : <span id="fipNo"></span></div>
            <div class="line">Nozzle No : <span id="nozzleNo"></span></div>
            <div class="line">Product : <span id="product"></span></div>

            <div class="spacer"></div>

            <div class="line">Preset Type : <span id="presetType"></span></div>
            <div class="line">Rate (Rs/L) : <span id="rate"></span></div>
            <div class="line">Volume (L) : <span id="volume"></span></div>
            <div class="line">Amount (Rs) : <span id="amount"></span></div>
            <div class="line">Atot : <span id="atot"></span></div>
            <div class="line">Vtot : <span id="vtot"></span></div>

            <div class="spacer"></div>

            <div class="line">Vehicle No : <span id="vehicleNo"></span></div>
            <div class="line">Mobile No : <span id="mobileNo"></span></div>

            <div class="spacer"></div>

            <div class="line">Date : <span id="date"></span></div>
            <div class="line">Time : <span id="time"></span></div>

            <div class="spacer"></div>

            <div class="line">CST No : <span id="cstNo"></span></div>
            <div class="line">LST No : <span id="lstNo"></span></div>
            <div class="line">VAT No : <span id="vatNo"></span></div>

            <div class="spacer"></div>

            <div class="line">Attendant ID : Not Available</div>
            <div class="line">FCC Date : Not Available</div>
            <div class="line">FCC Time : Not Available</div>
        </div>

        <button class="export-btn" onclick="exportPDF()">Export PDF (58mm)</button>
    </div>

</div>

<script>

// ---------- Auto-calculate Amount ----------
function calculateAmount() {
    const rate = parseFloat(document.getElementById("in_rate").value);
    const volume = parseFloat(document.getElementById("in_volume").value);

    if (!isNaN(rate) && !isNaN(volume)) {
        const amount = (rate * volume).toFixed(2);
        document.getElementById("in_amount").value = amount;
    } else {
        document.getElementById("in_amount").value = "";
    }
}

// ---------- Update receipt preview ----------
function updateReceipt() {
    randomizeReceiptNo();  // Randomize receipt number
    randomizeTotals();     // Randomize Atot and Vtot
    calculateAmount();     // Ensure amount is correct
    const fields = [
        "receiptNo","fccId","fipNo","nozzleNo","product",
        "presetType","rate","volume","amount",
        "atot","vtot","vehicleNo","mobileNo",
        "date","time","cstNo","lstNo","vatNo"
    ];

    fields.forEach(f => {
        document.getElementById(f).textContent =
            document.getElementById("in_" + f).value || "";
    });
}

function randomizeReceiptNo() {
    const prefix = "L6"; // keep your usual prefix
    const randomDigits = Math.floor(1000 + Math.random() * 9000); // 4-digit random number
    document.getElementById("in_receiptNo").value = prefix + randomDigits;
}

function randomizeTotals() {

    // Simulate realistic pump totals
    const atotBase = 10000000000; // base total amount in Rs
    const vtotBase = 923400000;   // base total volume in L

    // Randomly add 0–100000 for amount, 0–50000 for volume
    const atotRandom = (atotBase + Math.floor(Math.random() * 100000) + Math.random()).toFixed(2);
    const vtotRandom = (vtotBase + Math.floor(Math.random() * 50000) + Math.random()).toFixed(3);

    document.getElementById("in_atot").value = atotRandom;
    document.getElementById("in_vtot").value = vtotRandom;

}

// ---------- Export PDF ----------
async function exportPDF() {
    const receipt = document.getElementById("receipt");

    const canvas = await html2canvas(receipt, {
        scale: 2,
        backgroundColor: "#f8f6f6"
    });

    const imgData = canvas.toDataURL("image/png");
    const { jsPDF } = window.jspdf;

    const pdfWidth = 58;
    const topMargin = 4;
    const bottomMargin = 6;

    const contentHeight = (canvas.height * pdfWidth) / canvas.width;
    const pdfHeight = contentHeight + topMargin + bottomMargin;

    const doc = new jsPDF({
        orientation: "p",
        unit: "mm",
        format: [pdfWidth, pdfHeight]
    });

    doc.addImage(imgData, "PNG", 0, topMargin, pdfWidth, contentHeight);
    // doc.save("IndianOil_Receipt_58mm.pdf");
    const receiptNo = document.getElementById("in_receiptNo").value || "receipt";
    doc.save(`${receiptNo}.pdf`);
}

// ---------- Initial load ----------
updateReceipt();
</script>

</body>
</html>
